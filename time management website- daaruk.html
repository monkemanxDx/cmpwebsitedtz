<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Student Planner</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #2d3748;
      overflow-x: hidden;
      overflow-y: auto;
    }

    nav {
      display: flex;
      justify-content: center;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      padding: 1.5rem 2rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 1000;
      flex-wrap: wrap;
      gap: 1rem;
    }

    nav a {
      color: #4a5568;
      text-decoration: none;
      font-weight: 500;
      font-size: 0.95rem;
      padding: 0.75rem 1.5rem;
      border-radius: 12px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      background: rgba(255, 255, 255, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    nav a:hover {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }

    .page {
      display: none;
      padding: 2rem;
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      margin-top: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .active {
      display: block;
      animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    h2 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 2rem;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-align: center;
    }

    table.calendar {
      width: 100%;
      max-width: 1000px;
      margin: 2rem auto;
      border-collapse: separate;
      border-spacing: 0;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
      background: white;
    }

    table.calendar td,
    table.calendar th {
      border: none;
      padding: 1rem;
      text-align: center;
      vertical-align: top;
      position: relative;
    }

    table.calendar th {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      font-weight: 600;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    table.calendar td {
      background: white;
      border-bottom: 1px solid #f7fafc;
      border-right: 1px solid #f7fafc;
      transition: all 0.3s ease;
    }

    table.calendar td:hover {
      background: rgba(102, 126, 234, 0.05);
      transform: scale(1.02);
    }

    .today {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)) !important;
      border: 2px solid #667eea;
      font-weight: 600;
    }

    .calendar textarea {
      width: 100%;
      height: 60px;
      margin-top: 8px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      padding: 8px;
      font-family: inherit;
      font-size: 0.85rem;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.9);
      resize: vertical;
    }

    .calendar textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .timetable-container {
      margin-top: 2rem;
    }

    .timetable {
      width: 100%;
      max-width: 1000px;
      margin: auto;
      border-collapse: separate;
      border-spacing: 0;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
      background: white;
    }

    .timetable th,
    .timetable td {
      border: none;
      padding: 1.5rem 1rem;
      vertical-align: top;
      border-bottom: 1px solid #f7fafc;
      border-right: 1px solid #f7fafc;
    }

    .timetable th {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      font-weight: 600;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .timetable td {
      background: white;
      min-height: 120px;
    }

    .org-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-top: 2rem;
      list-style: none;
    }

    .org-grid li {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .org-grid li:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
    }

    #taskList li.completed,
    #orgList li.completed {
      text-decoration: line-through;
      color: #a0aec0;
      opacity: 0.7;
    }

    .money-box {
      margin-top: 2rem;
      max-width: 500px;
      background: white;
      padding: 2rem;
      border-radius: 16px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .money-box h3 {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .money-box label {
      display: block;
      margin-bottom: 1rem;
      font-weight: 500;
      color: #4a5568;
    }

    .money-box input {
      width: 120px;
      margin-left: 0.5rem;
      padding: 0.5rem;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-family: inherit;
      transition: all 0.3s ease;
    }

    .money-box input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .money-warning {
      color: #e53e3e;
      font-weight: 600;
      padding: 1rem;
      background: rgba(229, 62, 62, 0.1);
      border-radius: 8px;
      border-left: 4px solid #e53e3e;
      margin-top: 1rem;
    }

    footer {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      text-align: center;
      padding: 2rem;
      margin-top: 4rem;
      font-weight: 500;
    }

    .progress-table {
      max-width: 800px;
      margin: auto;
      border-collapse: separate;
      border-spacing: 0;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    }

    .progress-table th,
    .progress-table td {
      border: none;
      padding: 1rem;
      text-align: center;
      border-bottom: 1px solid #f7fafc;
    }

    .progress-table th {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      font-weight: 600;
    }

    /* Form Controls */
    input, select, textarea, button {
      font-family: inherit;
      font-size: 0.95rem;
    }

    input[type="text"], input[type="time"], input[type="number"], input[type="color"], select, textarea {
      padding: 0.75rem 1rem;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      transition: all 0.3s ease;
      background: white;
    }

    input[type="text"]:focus, input[type="time"]:focus, input[type="number"]:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    button {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }

    button:active {
      transform: translateY(0);
    }

    /* Navigation controls */
    .nav-controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .nav-controls button {
      background: rgba(255, 255, 255, 0.9);
      color: #4a5568;
      border: 2px solid #e2e8f0;
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
    }

    .nav-controls button:hover {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border-color: transparent;
    }

    #monthYearLabel {
      font-size: 1.25rem;
      font-weight: 600;
      color: #2d3748;
      margin: 0 1rem;
    }

    /* Task controls */
    .task-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .task-controls > * {
      flex: 1;
      min-width: 120px;
    }

    /* Notes area */
    #subjectNotes {
      width: 100%;
      min-height: 300px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      padding: 1.5rem;
      font-family: inherit;
      font-size: 0.95rem;
      line-height: 1.6;
      resize: vertical;
    }

    /* Settings controls */
    .settings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .settings-item {
      background: rgba(255, 255, 255, 0.7);
      padding: 1.5rem;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .settings-item label {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-weight: 500;
      color: #4a5568;
    }

    /* Checkboxes */
    input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: #667eea;
      cursor: pointer;
    }

    /* Today's date display */
    .date-display {
      background: rgba(255, 255, 255, 0.9);
      padding: 1rem 1.5rem;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      margin-bottom: 1.5rem;
      text-align: center;
      font-weight: 500;
      color: #4a5568;
    }

    /* Item input section */
    .add-item-section {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .add-item-section input {
      flex: 1;
    }

    /* Notes controls */
    .notes-controls {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }

    .notes-controls label {
      font-weight: 500;
      color: #4a5568;
    }

    .notes-controls select {
      min-width: 150px;
    }

    /* Save status */
    #saveStatus {
      background: rgba(72, 187, 120, 0.1);
      color: #2f855a;
      padding: 1rem;
      border-radius: 8px;
      border-left: 4px solid #48bb78;
      margin-top: 1rem;
      font-weight: 500;
    }

    /* Money status */
    #moneyStatus p {
      padding: 1rem;
      border-radius: 8px;
      margin-top: 1rem;
      font-weight: 500;
    }

    #moneyStatus p:not(.money-warning) {
      background: rgba(72, 187, 120, 0.1);
      color: #2f855a;
      border-left: 4px solid #48bb78;
    }

    /* Task divs in timetable */
    .timetable td div {
      background: rgba(102, 126, 234, 0.1);
      padding: 0.5rem;
      margin-bottom: 0.5rem;
      border-radius: 6px;
      border-left: 3px solid #667eea;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .page {
        margin: 1rem;
        padding: 1.5rem;
      }

      nav {
        padding: 1rem;
      }

      nav a {
        padding: 0.5rem 1rem;
        font-size: 0.9rem;
      }

      h2 {
        font-size: 1.5rem;
      }

      .task-controls, .add-item-section {
        flex-direction: column;
      }

      .nav-controls {
        flex-direction: column;
        gap: 0.5rem;
      }

      .org-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <nav>
    <a href="#" onclick="showPage('calendar')">Calendar</a>
    <a href="#" onclick="showPage('weekly')">Weekly Timetable</a>
    <a href="#" onclick="showPage('organisation')">Organisation</a>
    <a href="#" onclick="showPage('notes')">Notes</a>
    <a href="#" onclick="showPage('settings')">Settings</a>
  </nav>

  <div id="calendar" class="page active">
    <h2>Monthly Calendar</h2>
    <div class="nav-controls">
      <button onclick="changeMonth(-1)">← Previous</button>
      <span id="monthYearLabel"></span>
      <button onclick="changeMonth(1)">Next →</button>
    </div>
    <table class="calendar" id="monthCalendar"></table>
  </div>

  <div id="weekly" class="page">
    <h2>Weekly Timetable</h2>
    <div class="task-controls">
      <select id="taskDay">
        <option value="0">Monday</option>
        <option value="1">Tuesday</option>
        <option value="2">Wednesday</option>
        <option value="3">Thursday</option>
        <option value="4">Friday</option>
        <option value="5">Saturday</option>
        <option value="6">Sunday</option>
      </select>
      <input type="time" id="taskTime" step="60">
      <input type="text" id="taskNote" placeholder="Task description...">
      <select id="taskSubject">
        <option value="">No Subject</option>
        <option>Math</option>
        <option>English</option>
        <option>Science</option>
        <option>INS</option>
        <option>PHE</option>
        <option>Design</option>
        <option>Music</option>
        <option>Visual Arts</option>
        <option>Languages</option>
        <option>CCAs</option>
        <option>Sports</option>
        <option>Other</option>
      </select>
      <button onclick="addWeeklyTask()">Add Task</button>
    </div>
    <table class="timetable" id="weeklyTimetable">
      <thead>
        <tr>
          <th>Monday</th>
          <th>Tuesday</th>
          <th>Wednesday</th>
          <th>Thursday</th>
          <th>Friday</th>
          <th>Saturday</th>
          <th>Sunday</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td id="day0"></td>
          <td id="day1"></td>
          <td id="day2"></td>
          <td id="day3"></td>
          <td id="day4"></td>
          <td id="day5"></td>
          <td id="day6"></td>
        </tr>
      </tbody>
    </table>
  </div>

  <div id="organisation" class="page">
    <h2>Organisation - Items You Own</h2>
    <div class="date-display">Today's Date: <span id="todayDate"></span></div>
    <div class="add-item-section">
      <input type="text" id="orgItem" placeholder="Add a new item..." />
      <button onclick="addOrgItem()">Add Item</button>
    </div>
    <ul id="orgList" class="org-grid"></ul>
    <div class="money-box">
      <h3>Money Tracker</h3>
      <label>Total Needed: $<input type="number" id="moneyNeeded" value="0"></label>
      <label>Current Amount: $<input type="number" id="moneyHave" value="0"></label>
      <button onclick="updateMoneyStatus()">Update Status</button>
      <div id="moneyStatus"></div>
    </div>
  </div>

  <div id="notes" class="page">
    <h2>Study Notes</h2>
    <div class="notes-controls">
      <label for="notesSubject">Select Subject:</label>
      <select id="notesSubject" onchange="loadNotes()">
        <option value="Math">Math</option>
        <option value="English">English</option>
        <option value="Science">Science</option>
        <option value="INS">INS</option>
        <option value="PHE">PHE</option>
        <option value="Design">Design</option>
        <option value="Music">Music</option>
        <option value="Visual Arts">Visual Arts</option>
        <option value="Languages">Languages</option>
        <option value="CCAs">CCAs</option>
        <option value="Sports">Sports</option>
        <option value="Other">Other</option>
      </select>
      <button onclick="saveNotes()">Save Notes</button>
    </div>
    <textarea id="subjectNotes" placeholder="Write your study notes here..."></textarea>
    <p id="saveStatus" style="display: none;">Notes saved successfully!</p>
  </div>

  <div id="settings" class="page">
    <h2>Customization Settings</h2>
    <div class="settings-grid">
      <div class="settings-item">
        <label>Background Color: <input type="color" id="bgColorPicker" /></label>
      </div>
      <div class="settings-item">
        <label>Text Color: <input type="color" id="textColorPicker" /></label>
      </div>
      <div class="settings-item">
        <label>Font Size: <input type="number" id="fontSize" min="10" max="30" value="16" /> px</label>
      </div>
      <div class="settings-item">
        <label><input type="checkbox" id="toggleCalendar" checked onchange="toggleSection('calendar')" /> Show Calendar</label>
      </div>
      <div class="settings-item">
        <label><input type="checkbox" id="toggleWeekly" checked onchange="toggleSection('weekly')" /> Show Timetable</label>
      </div>
      <div class="settings-item">
        <label><input type="checkbox" id="toggleOrganisation" checked onchange="toggleSection('organisation')" /> Show Organisation</label>
      </div>
    </div>
    <button onclick="applySettings()">Apply All Settings</button>
  </div>

  <footer>
    Made by Daaruk and co
  </footer>

 <script>
  document.getElementById("todayDate").textContent = new Date().toLocaleDateString();

  // ========== ORGANISATION ==========
function showPage(pageId) {
  // Hide all pages
  document.querySelectorAll('.page').forEach(page => {
    page.classList.remove('active');
  });
  // Show selected page
  document.getElementById(pageId).classList.add('active');
}

  function saveOrgList() {
    const orgListItems = [];
    document.querySelectorAll("#orgList li").forEach(li => {
      orgListItems.push({
        text: li.textContent.trim(),
        completed: li.classList.contains("completed")
      });
    });
    localStorage.setItem("orgList", JSON.stringify(orgListItems));
  }

  function loadOrgList() {
    const orgListStr = localStorage.getItem("orgList");
    if (orgListStr) {
      const orgListItems = JSON.parse(orgListStr);
      const ul = document.getElementById("orgList");
      ul.innerHTML = "";
      orgListItems.forEach(item => {
        const li = document.createElement("li");
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = item.completed;
        if (item.completed) li.classList.add("completed");
        checkbox.onchange = () => {
          li.classList.toggle("completed", checkbox.checked);
          saveOrgList();
        };
        li.appendChild(document.createTextNode(" " + item.text));
        li.prepend(checkbox);
        ul.appendChild(li);
      });
    }
  }

  function addOrgItem() {
    const val = document.getElementById("orgItem").value;
    if (!val) return;
    const li = document.createElement("li");
    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.onchange = () => {
      li.classList.toggle("completed", checkbox.checked);
      saveOrgList();
    };
    li.appendChild(document.createTextNode(" " + val));
    li.prepend(checkbox);
    document.getElementById("orgList").appendChild(li);
    document.getElementById("orgItem").value = "";
    saveOrgList();
  }

  // ========== MONEY TRACKER ==========

  function updateMoneyStatus() {
    const neededInput = document.getElementById("moneyNeeded");
    const haveInput = document.getElementById("moneyHave");
    const needed = parseFloat(neededInput.value) || 0;
    const have = parseFloat(haveInput.value) || 0;
    const diff = needed - have;
    const status = document.getElementById("moneyStatus");
    if (diff > 0) {
      status.innerHTML = `<p class='money-warning'>You are missing $${diff.toFixed(2)}</p>`;
    } else {
      status.innerHTML = `<p>You have all the money you need!</p>`;
    }
    // Save money values
    localStorage.setItem("moneyNeeded", needed);
    localStorage.setItem("moneyHave", have);
  }

  function loadMoneyStatus() {
    const needed = localStorage.getItem("moneyNeeded");
    const have = localStorage.getItem("moneyHave");
    if (needed !== null) document.getElementById("moneyNeeded").value = needed;
    if (have !== null) document.getElementById("moneyHave").value = have;
    updateMoneyStatus();
  }

  // ========== WEEKLY TIMETABLE ==========

  function saveWeeklyTasks() {
    const tasks = {};
    for (let i = 0; i <= 6; i++) {
      const dayCell = document.getElementById("day" + i);
      const dayTasks = [];
      dayCell.querySelectorAll("div").forEach(taskDiv => {
        const checkbox = taskDiv.querySelector("input[type=checkbox]");
        const time = taskDiv.getAttribute("data-time");
        // Extract innerHTML excluding checkbox
        const text = taskDiv.textContent.trim();
        dayTasks.push({
          time: time,
          text: text,
          completed: checkbox.checked
        });
      });
      tasks[i] = dayTasks;
    }
    localStorage.setItem("weeklyTasks", JSON.stringify(tasks));
  }

  function loadWeeklyTasks() {
    const tasksStr = localStorage.getItem("weeklyTasks");
    if (!tasksStr) return;
    const tasks = JSON.parse(tasksStr);
    for (let i = 0; i <= 6; i++) {
      const dayCell = document.getElementById("day" + i);
      dayCell.innerHTML = "";
      if (!tasks[i]) continue;
      // Recreate tasks sorted by time
      const sortedTasks = tasks[i].sort((a, b) => a.time.localeCompare(b.time));
      sortedTasks.forEach(task => {
        const taskDiv = document.createElement("div");
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = task.completed;
        checkbox.onchange = saveWeeklyTasks;
        taskDiv.appendChild(checkbox);
        taskDiv.appendChild(document.createTextNode(" " + task.text));
        taskDiv.setAttribute("data-time", task.time);
        dayCell.appendChild(taskDiv);
      });
    }
  }

  function addWeeklyTask() {
    const dayIndex = parseInt(document.getElementById("taskDay").value);
    const time = document.getElementById("taskTime").value;
    const note = document.getElementById("taskNote").value;
    const subject = document.getElementById("taskSubject").value;

    if (!time || !note) return;

    const task = document.createElement("div");
    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.onchange = saveWeeklyTasks;
    task.appendChild(checkbox);
    task.innerHTML += ` <strong>${time}</strong> - ${subject ? "[" + subject + "] " : ""}${note}`;
    task.setAttribute("data-time", time);

    const dayCell = document.getElementById("day" + dayIndex);
    const tasks = Array.from(dayCell.children);
    tasks.push(task);
    tasks.sort((a, b) => a.getAttribute("data-time").localeCompare(b.getAttribute("data-time")));

    dayCell.innerHTML = "";
    tasks.forEach(t => dayCell.appendChild(t));

    document.getElementById("taskTime").value = "";
    document.getElementById("taskNote").value = "";
    document.getElementById("taskSubject").value = "";

    saveWeeklyTasks();
  }

  // ========== CALENDAR ==========

  const monthCalendar = document.getElementById("monthCalendar");
  const monthYearLabel = document.getElementById("monthYearLabel");

  let currentDate = new Date();

  // Save current month/year to localStorage
  function saveCurrentMonthYear() {
    localStorage.setItem("calendarYear", currentDate.getFullYear());
    localStorage.setItem("calendarMonth", currentDate.getMonth());
  }

  // Load current month/year from localStorage
  function loadCurrentMonthYear() {
    const y = localStorage.getItem("calendarYear");
    const m = localStorage.getItem("calendarMonth");
    if (y !== null && m !== null) {
      currentDate = new Date(parseInt(y), parseInt(m), 1);
    }
  }

  function changeMonth(offset) {
    currentDate.setMonth(currentDate.getMonth() + offset);
    renderCalendar();
    saveCurrentMonthYear();
  }

  function saveCalendarNotes(year, month, day, note) {
    const key = `calendarNote_${year}_${month}_${day}`;
    localStorage.setItem(key, note);
  }

  function loadCalendarNote(year, month, day) {
    const key = `calendarNote_${year}_${month}_${day}`;
    return localStorage.getItem(key) || "";
  }

  function renderCalendar() {
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();

    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const startDay = firstDay.getDay();
    const daysInMonth = lastDay.getDate();

    monthYearLabel.textContent = `${currentDate.toLocaleString('default', { month: 'long' })} ${year}`;

    let html = "<tr>";
    const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
    for (let i = 0; i < 7; i++) {
      html += `<th>${weekdays[i]}</th>`;
    }
    html += "</tr><tr>";

    let dayCount = 0;

    for (let i = 0; i < startDay; i++) {
      html += "<td></td>";
      dayCount++;
    }

    for (let day = 1; day <= daysInMonth; day++) {
      if (dayCount % 7 === 0 && day !== 1) {
        html += "</tr><tr>";
      }

      const isToday = new Date().toDateString() === new Date(year, month, day).toDateString();
      const savedNote = loadCalendarNote(year, month, day);

      html += `<td class="${isToday ? "today" : ""}"><strong>${day}</strong><br/>` +
        `<textarea placeholder="Notes..." data-year="${year}" data-month="${month}" data-day="${day}">${savedNote}</textarea></td>`;
      dayCount++;
    }

    while (dayCount % 7 !== 0) {
      html += "<td></td>";
      dayCount++;
    }

    html += "</tr>";
    monthCalendar.innerHTML = html;

    // Add event listeners for textareas to save notes on input
    monthCalendar.querySelectorAll("textarea").forEach(textarea => {
      textarea.addEventListener("input", e => {
        const y = textarea.getAttribute("data-year");
        const m = textarea.getAttribute("data-month");
        const d = textarea.getAttribute("data-day");
        saveCalendarNotes(y, m, d, textarea.value);
      });
    });
  }

  // ========== NOTES ==========

  function loadNotes() {
    const subject = document.getElementById("notesSubject").value;
    const notes = localStorage.getItem("notes_" + subject) || "";
    document.getElementById("subjectNotes").value = notes;
    document.getElementById("saveStatus").style.display = "none";
  }

  function saveNotes() {
    const subject = document.getElementById("notesSubject").value;
    const notes = document.getElementById("subjectNotes").value;
    localStorage.setItem("notes_" + subject, notes);
    const status = document.getElementById("saveStatus");
    status.style.display = "block";
    setTimeout(() => {
      status.style.display = "none";
    }, 2000);
  }

  // ========== SETTINGS ==========

  function saveSettings() {
    const bgColor = document.getElementById("bgColorPicker").value;
    const textColor = document.getElementById("textColorPicker").value;
    const fontSize = document.getElementById("fontSize").value;
    const toggleCalendar = document.getElementById("toggleCalendar").checked;
    const toggleWeekly = document.getElementById("toggleWeekly").checked;
    const toggleOrganisation = document.getElementById("toggleOrganisation").checked;

    localStorage.setItem("setting_bgColor", bgColor);
    localStorage.setItem("setting_textColor", textColor);
    localStorage.setItem("setting_fontSize", fontSize);
    localStorage.setItem("setting_toggleCalendar", toggleCalendar);
    localStorage.setItem("setting_toggleWeekly", toggleWeekly);
    localStorage.setItem("setting_toggleOrganisation", toggleOrganisation);
  }

  function loadSettings() {
    const bgColor = localStorage.getItem("setting_bgColor");
    const textColor = localStorage.getItem("setting_textColor");
    const fontSize = localStorage.getItem("setting_fontSize");
    const toggleCalendar = localStorage.getItem("setting_toggleCalendar");
    const toggleWeekly = localStorage.getItem("setting_toggleWeekly");
    const toggleOrganisation = localStorage.getItem("setting_toggleOrganisation");

    if (bgColor) document.getElementById("bgColorPicker").value = bgColor;
    if (textColor) document.getElementById("textColorPicker").value = textColor;
    if (fontSize) document.getElementById("fontSize").value = fontSize;
    if (toggleCalendar !== null) {
      const val = (toggleCalendar === "true");
      document.getElementById("toggleCalendar").checked = val;
      toggleSection("calendar");
    }
    if (toggleWeekly !== null) {
      const val = (toggleWeekly === "true");
      document.getElementById("toggleWeekly").checked = val;
      toggleSection("weekly");
    }
    if (toggleOrganisation !== null) {
      const val = (toggleOrganisation === "true");
      document.getElementById("toggleOrganisation").checked = val;
      toggleSection("organisation");
    }

    applySettings();
  }

  function applySettings() {
    const bgColor = document.getElementById("bgColorPicker").value;
    const textColor = document.getElementById("textColorPicker").value;
    const fontSize = document.getElementById("fontSize").value;

    if (bgColor) {
      document.body.style.background = bgColor;
    }
    if (textColor) {
      document.body.style.color = textColor;
    }
    if (fontSize) {
      document.body.style.fontSize = fontSize + "px";
    }
  }

  function toggleSection(sectionName) {
    const checkbox = document.getElementById("toggle" + sectionName.charAt(0).toUpperCase() + sectionName.slice(1));
    const navLink = document.querySelector(`nav a[onclick="showPage('${sectionName}')"]`);
    
    if (checkbox.checked) {
      navLink.style.display = "block";
    } else {
      navLink.style.display = "none";
    }
  }

  // ========== INITIAL LOAD ==========

  loadCurrentMonthYear();
  renderCalendar();

  loadOrgList();
  loadMoneyStatus();

  loadWeeklyTasks();

  loadSettings();

  loadNotes(); // for default subject

  // ========== EVENT LISTENERS ==========

  // Save weekly tasks on checkbox toggle handled in addWeeklyTask and loadWeeklyTasks

  // Save organisation list on checkbox toggle handled in addOrgItem and loadOrgList

  // Save money on update button click handled in updateMoneyStatus

  // Save notes on button click already handled

  // Save settings on apply button click
  document.querySelector("button[onclick='applySettings()']").addEventListener("click", () => {
    applySettings();
    saveSettings();
  });

  // Save money on input change (optional)
  document.getElementById("moneyNeeded").addEventListener("input", updateMoneyStatus);
  document.getElementById("moneyHave").addEventListener("input", updateMoneyStatus);

  // Load notes on subject change
  document.getElementById("notesSubject").addEventListener("change", loadNotes);

</script>
</body>

</html>